# å‰ç«¯ç”¨ä¾‹å®Œæ•´æµç¨‹

> ä¾›åç«¯å¼€å‘è€…ç†è§£å‰ç«¯åº”ç”¨çš„ç”¨æˆ·ä½¿ç”¨åœºæ™¯å’Œ API è°ƒç”¨æ—¶æœº

---

## åº”ç”¨æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å® ç‰©é¥®é£Ÿè®¡åˆ’åº”ç”¨                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·è®¤è¯å±‚    â†’  ç™»å½•/æ³¨å†Œ/Token ç®¡ç†                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å® ç‰©ç®¡ç†å±‚    â†’  æ·»åŠ /ç¼–è¾‘/åˆ é™¤å® ç‰©                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®¡åˆ’ç”Ÿæˆå±‚    â†’  AI ç”Ÿæˆé¥®é£Ÿè®¡åˆ’ (SSE æµå¼)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¥å¸¸ä½¿ç”¨å±‚    â†’  æŸ¥çœ‹é¤é£Ÿ/æ‰“å¡å®Œæˆ/è¥å…»åˆ†æ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æµç¨‹ä¸€ï¼šæ–°ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨

### å®Œæ•´æµç¨‹å›¾

```mermaid
flowchart TD
    A[æ‰“å¼€åº”ç”¨] --> B{å·²ç™»å½•?}
    B -->|å¦| C[ç™»å½•é¡µé¢]
    C --> D{é€‰æ‹©æ“ä½œ}
    D -->|ç™»å½•| E[è¾“å…¥é‚®ç®±/å¯†ç ]
    D -->|æ³¨å†Œ| F[è¾“å…¥ç”¨æˆ·å/é‚®ç®±/å¯†ç ]
    F --> G[å‘é€éªŒè¯ç ]
    G --> H[è¾“å…¥éªŒè¯ç ]
    H --> I[æ³¨å†ŒæˆåŠŸ]
    E --> J[ç™»å½•æˆåŠŸ]
    I --> J
    J --> K[è¿›å…¥é¦–é¡µ]
    B -->|æ˜¯| K
    K --> L{æœ‰å® ç‰©?}
    L -->|å¦| M[æ˜¾ç¤ºå¼•å¯¼å¡ç‰‡]
    M --> N[ç‚¹å‡»æ·»åŠ å® ç‰©]
    N --> O[Onboarding æµç¨‹]
    L -->|æ˜¯| P[æ˜¾ç¤ºå® ç‰©ä¿¡æ¯]
```

### æ­¥éª¤è¯¦è§£

#### 1.1 æ³¨å†Œæµç¨‹

| æ­¥éª¤ | ç”¨æˆ·æ“ä½œ | å‰ç«¯è¡Œä¸º | éœ€è¦çš„ API |
|------|----------|----------|------------|
| 1 | ç‚¹å‡»"ç«‹å³æ³¨å†Œ" | è·³è½¬åˆ°æ³¨å†Œé¡µ | - |
| 2 | è¾“å…¥ç”¨æˆ·å/é‚®ç®±/å¯†ç  | è¡¨å•éªŒè¯ | - |
| 3 | ç‚¹å‡»"å‘é€éªŒè¯ç " | è°ƒç”¨ APIï¼Œå¼€å§‹ 60s å€’è®¡æ—¶ | `POST /auth/send-code` |
| 4 | è¾“å…¥æ”¶åˆ°çš„éªŒè¯ç  | - | - |
| 5 | ç‚¹å‡»"æ³¨å†Œ" | è°ƒç”¨ APIï¼Œä¿å­˜ Token | `POST /auth/verify-register` |
| 6 | è‡ªåŠ¨è·³è½¬é¦–é¡µ | è®¾ç½®ç”¨æˆ·çŠ¶æ€ | - |

#### 1.2 ç™»å½•æµç¨‹

| æ­¥éª¤ | ç”¨æˆ·æ“ä½œ | å‰ç«¯è¡Œä¸º | éœ€è¦çš„ API |
|------|----------|----------|------------|
| 1 | è¾“å…¥é‚®ç®±/å¯†ç  | è¡¨å•éªŒè¯ | - |
| 2 | ç‚¹å‡»"ç™»å½•" | è°ƒç”¨ APIï¼Œä¿å­˜ Token | `POST /auth/login` |
| 3 | è‡ªåŠ¨è·³è½¬é¦–é¡µ | è·å–ç”¨æˆ·ä¿¡æ¯ | `GET /auth/me` |

---

## æµç¨‹äºŒï¼šæ·»åŠ å® ç‰©ï¼ˆOnboardingï¼‰

### å®Œæ•´æµç¨‹å›¾

```mermaid
flowchart LR
    A[Step 1: åå­—å’Œå¤´åƒ] --> B[Step 2: åŸºç¡€ä¿¡æ¯] --> C[Step 3: å¥åº·çŠ¶å†µ] --> D[åˆ›å»ºå®Œæˆ]
```

### ä¸‰æ­¥éª¤è¯¦è§£

#### 2.1 Step 1 - OnboardingName.jsx

**é¡µé¢åŠŸèƒ½ï¼š**
- ä¸Šä¼ å® ç‰©å¤´åƒï¼ˆä½¿ç”¨è®¾å¤‡ç›¸æœº/ç›¸å†Œï¼‰
- è¾“å…¥å® ç‰©åå­—

**ç”¨æˆ·æ“ä½œï¼š**
1. ç‚¹å‡»å¤´åƒåŒºåŸŸ â†’ å¼¹å‡ºé€‰æ‹©ï¼šæ‹ç…§ / ä»ç›¸å†Œé€‰æ‹©
2. è¾“å…¥å® ç‰©åå­—
3. ç‚¹å‡»"ä¸‹ä¸€æ­¥"

**æ•°æ®æš‚å­˜ï¼š**
```javascript
{
  name: "Cooper",
  avatar: "base64://..." // æˆ–å›¾ç‰‡ URL
}
```

#### 2.2 Step 2 - OnboardingBasic.jsx

**é¡µé¢åŠŸèƒ½ï¼š**
- é€‰æ‹©å® ç‰©ç±»å‹ï¼ˆçŒ«/ç‹—ï¼‰
- é€‰æ‹©å“ç§ï¼ˆåŸºäºç±»å‹ç­›é€‰ï¼‰
- è¾“å…¥å¹´é¾„ï¼ˆæœˆï¼‰
- è¾“å…¥ä½“é‡ï¼ˆkgï¼‰
- é€‰æ‹©æ€§åˆ«

**ç”¨æˆ·æ“ä½œï¼š**
1. é€‰æ‹©å® ç‰©ç±»å‹å¡ç‰‡ï¼ˆçŒ«/ç‹—ï¼‰
2. ä¸‹æ‹‰é€‰æ‹©å“ç§
3. è¾“å…¥å¹´é¾„å’Œä½“é‡
4. é€‰æ‹©æ€§åˆ«
5. ç‚¹å‡»"ä¸‹ä¸€æ­¥"

**æ•°æ®ç´¯ç§¯ï¼š**
```javascript
{
  name: "Cooper",
  avatar: "base64://...",
  type: "dog",
  breed: "é‡‘æ¯›å·¡å›çŠ¬",
  age: 36,  // æœˆ
  weight: 32,
  gender: "male"
}
```

#### 2.3 Step 3 - OnboardingHealth.jsx

**é¡µé¢åŠŸèƒ½ï¼š**
- é€‰æ‹©/è¾“å…¥å¥åº·çŠ¶å†µ
- è¾“å…¥ç‰¹æ®Šéœ€æ±‚ï¼ˆå¯é€‰ï¼‰

**ç”¨æˆ·æ“ä½œï¼š**
1. é€‰æ‹©å¥åº·æ ‡ç­¾ï¼ˆå¥åº·/è¶…é‡/è¿‡æ•/è‚ èƒƒæ•æ„Ÿ/è€å¹´çŠ¬ç­‰ï¼‰
2. è¾“å…¥ç‰¹æ®Šé¥®é£Ÿéœ€æ±‚ï¼ˆå¯é€‰ï¼‰
3. ç‚¹å‡»"å®Œæˆ"

**æœ€ç»ˆæäº¤æ•°æ®ï¼š**
```javascript
{
  name: "Cooper",
  avatar: "base64://...",
  type: "dog",
  breed: "é‡‘æ¯›å·¡å›çŠ¬",
  age: 36,
  weight: 32,
  gender: "male",
  health_status: "å¥åº·",
  special_requirements: "å¯¹é¸¡è‚‰è¿‡æ•"
}
```

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| åˆ›å»ºå® ç‰© | `POST /pets/` âš ï¸ ç¼ºå¤± |
| ä¸Šä¼ å¤´åƒ | `POST /pets/{pet_id}/avatar` âš ï¸ ç¼ºå¤± |

---

## æµç¨‹ä¸‰ï¼šç”Ÿæˆé¥®é£Ÿè®¡åˆ’

### å®Œæ•´æµç¨‹å›¾

```mermaid
flowchart TD
    A[é¦–é¡µ/ä¸ªäººä¸­å¿ƒ] --> B{å® ç‰©æœ‰è®¡åˆ’?}
    B -->|å¦| C[æ˜¾ç¤ºåˆ›å»ºè®¡åˆ’å¼•å¯¼]
    C --> D[ç‚¹å‡»åˆ›å»ºè®¡åˆ’]
    D --> E[CreatePlan é¡µé¢]
    E --> F[é€‰æ‹©å® ç‰©]
    F --> G[ç‚¹å‡»ç”Ÿæˆ]
    G --> H[Loading é¡µé¢ SSE è¿æ¥]
    H --> I[å®æ—¶æ˜¾ç¤ºè¿›åº¦]
    I --> J{ç”ŸæˆæˆåŠŸ?}
    J -->|æ˜¯| K[PlanSummary é¡µé¢]
    J -->|å¦| L[æ˜¾ç¤ºé”™è¯¯ï¼Œå¯é‡è¯•]
    K --> M[æŸ¥çœ‹è®¡åˆ’è¯¦æƒ…]
```

### æ­¥éª¤è¯¦è§£

#### 3.1 CreatePlan.jsx - åˆ›å»ºè®¡åˆ’é¡µ

**é¡µé¢åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºç”¨æˆ·æ‰€æœ‰å® ç‰©å¡ç‰‡
- é€‰æ‹©è¦åˆ›å»ºè®¡åˆ’çš„å® ç‰©
- ç¡®è®¤å® ç‰©ä¿¡æ¯

**ç”¨æˆ·æ“ä½œï¼š**
1. æŸ¥çœ‹å® ç‰©åˆ—è¡¨
2. ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªå® ç‰©
3. ç¡®è®¤å® ç‰©åŸºç¡€ä¿¡æ¯æ­£ç¡®
4. ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| è·å–å® ç‰©åˆ—è¡¨ | `GET /pets/` âš ï¸ ç¼ºå¤± |

#### 3.2 Loading.jsx - ç”Ÿæˆè¿›åº¦é¡µ

**é¡µé¢åŠŸèƒ½ï¼š**
- æ˜¾ç¤º AI ç”Ÿæˆè¿›åº¦ï¼ˆSSE å®æ—¶æ¨é€ï¼‰
- æ˜¾ç¤ºå½“å‰æ‰§è¡Œæ­¥éª¤åç§°
- æ˜¾ç¤ºæ‰§è¡Œæ—¥å¿—
- æ”¯æŒåå°ç”Ÿæˆï¼ˆç”¨æˆ·å¯ç¦»å¼€é¡µé¢ï¼‰

**SSE äº‹ä»¶å¤„ç†ï¼š**

```javascript
// å‰ç«¯æ¥æ”¶çš„ SSE äº‹ä»¶åºåˆ—ç¤ºä¾‹ï¼š
1. { type: "task_created", task_id: "xxx" }
   â†’ ä¿å­˜ task_idï¼Œç”¨äºæ–­çº¿é‡è¿

2. { type: "node_started", node: "main_agent" }
   â†’ æ›´æ–°æ˜¾ç¤ºï¼š"æ­£åœ¨åˆ†æå® ç‰©ä¿¡æ¯..."

3. { type: "node_completed", node: "main_agent", progress: 30 }
   â†’ è¿›åº¦æ¡æ›´æ–°åˆ° 30%

4. { type: "tool_started", tool: "search_nutrition" }
   â†’ æ—¥å¿—æ˜¾ç¤ºï¼š"æ­£åœ¨æœç´¢è¥å…»æ•°æ®..."

5. { type: "tool_completed", tool: "search_nutrition" }
   â†’ æ—¥å¿—æ˜¾ç¤ºï¼š"è¥å…»æ•°æ®è·å–å®Œæˆ"

6. { type: "node_started", node: "write_agent" }
   â†’ æ›´æ–°æ˜¾ç¤ºï¼š"æ­£åœ¨ç”Ÿæˆé¥®é£Ÿè®¡åˆ’..."

7. { type: "task_completed", task_id: "xxx", result: {...} }
   â†’ è¿›åº¦ 100%ï¼Œè·³è½¬åˆ°ç»“æœé¡µ
```

**æ–­çº¿é‡è¿åœºæ™¯ï¼š**
- ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ â†’ å›æ¥åè‡ªåŠ¨é‡è¿ SSE
- ç½‘ç»œæ–­å¼€ â†’ æ¢å¤åé€šè¿‡ task_id é‡è¿
- ä½¿ç”¨ `GET /plans/stream?task_id=xxx` æ¢å¤

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| åˆ›å»ºè®¡åˆ’ï¼ˆæµå¼ï¼‰ | `POST /plans/stream` âœ… |
| æ¢å¤ SSE è¿æ¥ | `GET /plans/stream?task_id=xxx` âœ… |
| æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ | `GET /tasks/{task_id}` âœ… |

#### 3.3 PlanSummary.jsx - è®¡åˆ’æ¦‚è§ˆé¡µ

**é¡µé¢åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºç”Ÿæˆçš„æœˆåº¦è®¡åˆ’æ¦‚è§ˆ
- æŒ‰å‘¨/æ—¥å±•ç¤ºé¤é£Ÿå®‰æ’
- æ˜¾ç¤ºè¥å…»ç›®æ ‡

**æ•°æ®éœ€æ±‚ï¼š**
```javascript
// ä» SSE result æˆ– API è·å–çš„è®¡åˆ’æ•°æ®ç»“æ„
{
  plan_id: "plan_xxx",
  pet_info: { name: "Cooper", ... },
  duration: "30 days",
  daily_plans: [
    {
      date: "2025-02-05",
      meals: [
        {
          type: "breakfast",
          name: "æ—©æ™¨å¹²ç²®æ··åˆ",
          time: "08:00",
          calories: 350,
          ingredients: ["é¸¡èƒ¸è‚‰ 100g", "ç³™ç±³ 50g"],
          nutrition: { protein: 28, fat: 12, carbs: 35 }
        },
        // ... lunch, dinner
      ],
      total_calories: 1180
    }
  ],
  nutrition_goals: {
    daily_calories: 1200,
    protein_ratio: 0.35,
    fat_ratio: 0.25,
    carbs_ratio: 0.40
  }
}
```

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| è·å–è®¡åˆ’è¯¦æƒ… | `GET /plans/{plan_id}` âœ… |

---

## æµç¨‹å››ï¼šæ—¥å¸¸ä½¿ç”¨

### 4.1 é¦–é¡µ - HomePage.jsx

**é¡µé¢å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: å® ç‰©é€‰æ‹©å™¨ + é€šçŸ¥            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‘¨å†è§†å›¾ï¼ˆå¯å·¦å³æ»‘åŠ¨æŸ¥çœ‹4å‘¨ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥è¥å…»è¿›åº¦                          â”‚
â”‚  â”œâ”€ å¡è·¯é‡Œï¼š850/1180 kcal             â”‚
â”‚  â”œâ”€ è›‹ç™½è´¨ï¼š60/95g                    â”‚
â”‚  â””â”€ è„‚è‚ªï¼š35/58g                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»Šæ—¥é¤é£Ÿåˆ—è¡¨                          â”‚
â”‚  â”œâ”€ ğŸŒ… æ—©é¤ [å·²å®Œæˆ âœ“]                â”‚
â”‚  â”œâ”€ ğŸŒ åˆé¤ [å¾…å®Œæˆ]                  â”‚
â”‚  â””â”€ ğŸŒ™ æ™šé¤ [å¾…å®Œæˆ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç”¨æˆ·æ“ä½œä¸ API è°ƒç”¨ï¼š**

| æ“ä½œ | å‰ç«¯è¡Œä¸º | éœ€è¦çš„ API |
|------|----------|------------|
| è¿›å…¥é¦–é¡µ | åŠ è½½ä»Šæ—¥æ•°æ® | `GET /meals/today?pet_id=xxx` âš ï¸ ç¼ºå¤± |
| åˆ‡æ¢å® ç‰© | æ›´æ–°å® ç‰© IDï¼Œé‡æ–°åŠ è½½ | `GET /meals/today?pet_id=xxx` |
| ç‚¹å‡»é¤é£Ÿå¡ç‰‡ | å±•å¼€æŸ¥çœ‹è¯¦æƒ… | - |
| ç‚¹å‡»"å®Œæˆ" | æ ‡è®°é¤é£Ÿå·²å®Œæˆ | `POST /meals/{meal_id}/complete` âš ï¸ ç¼ºå¤± |
| ç‚¹å‡»å‘¨å†æ—¥æœŸ | æŸ¥çœ‹è¯¥æ—¥è¯¦æƒ… | `GET /meals/date?pet_id=xxx&date=xxx` âš ï¸ ç¼ºå¤± |

### 4.2 é¤é£Ÿå®Œæˆæ‰“å¡

**äº¤äº’æµç¨‹ï¼š**
```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    
    User->>Frontend: ç‚¹å‡»é¤é£Ÿå¡ç‰‡
    Frontend->>Frontend: å±•å¼€æ˜¾ç¤ºè¯¦æƒ…
    User->>Frontend: ç‚¹å‡»"å®Œæˆç”¨é¤"
    Frontend->>Backend: POST /meals/{meal_id}/complete
    Backend-->>Frontend: { is_completed: true, completed_at: "..." }
    Frontend->>Frontend: æ›´æ–° UIï¼ˆæ‰“å‹¾åŠ¨ç”»ï¼‰
    Frontend->>Frontend: æ›´æ–°è¥å…»è¿›åº¦æ¡
```

### 4.3 æ—¥å†é¡µ - CalendarPage.jsx

**é¡µé¢åŠŸèƒ½ï¼š**
- æœˆåº¦æ—¥å†è§†å›¾
- æ¯æ—¥æ˜¾ç¤ºå®ŒæˆçŠ¶æ€æ ‡è®°ï¼ˆç»¿ç‚¹/çº¢ç‚¹/ç°ç‚¹ï¼‰
- ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¥æ—¥è¯¦æƒ…

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| è·å–æœˆåº¦æ•°æ® | `GET /calendar/monthly?pet_id=xxx&year=2025&month=2` âš ï¸ ç¼ºå¤± |
| è·å–æŒ‡å®šæ—¥æœŸè¯¦æƒ… | `GET /meals/date?pet_id=xxx&date=2025-02-05` âš ï¸ ç¼ºå¤± |

### 4.4 åˆ†æé¡µ - AnalysisPage.jsx

**é¡µé¢åŠŸèƒ½ï¼š**
- è¥å…»æ‘„å…¥è¶‹åŠ¿å›¾è¡¨
- å¡è·¯é‡Œ/è›‹ç™½è´¨/è„‚è‚ªå‘¨å¯¹æ¯”
- AI å¥åº·å»ºè®®

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| è·å–åˆ†ææ•°æ® | `GET /analysis/nutrition?pet_id=xxx&period=week` âš ï¸ ç¼ºå¤± |

---

## æµç¨‹äº”ï¼šä¸ªäººä¸­å¿ƒ

### 5.1 Profile.jsx - ä¸ªäººä¸»é¡µ

**é¡µé¢å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·å¤´åƒ + æ˜µç§° + é‚®ç®± + PROæ ‡è¯†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆ‘çš„å® ç‰©                              â”‚
â”‚  â”œâ”€ ğŸ• Cooper - é‡‘æ¯› [ç¼–è¾‘]           â”‚
â”‚  â”œâ”€ ğŸ± Luna - è‹±çŸ­ [ç¼–è¾‘]             â”‚
â”‚  â””â”€ [+ æ·»åŠ å® ç‰©]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| åŠ è½½ç”¨æˆ·ä¿¡æ¯ | `GET /auth/me` âœ… |
| åŠ è½½å® ç‰©åˆ—è¡¨ | `GET /pets/` âš ï¸ ç¼ºå¤± |
| åˆ é™¤å® ç‰© | `DELETE /pets/{pet_id}` âš ï¸ ç¼ºå¤± |

### 5.2 ProfileEdit.jsx - ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯

**é¡µé¢åŠŸèƒ½ï¼š**
- ä¿®æ”¹å¤´åƒï¼ˆæ‹ç…§/ç›¸å†Œï¼‰
- ä¿®æ”¹æ˜µç§°
- ä¿®æ”¹æ‰‹æœºå·

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| ä¸Šä¼ å¤´åƒ | `POST /auth/avatar` âš ï¸ ç¼ºå¤± |
| æ›´æ–°ä¿¡æ¯ | `PUT /auth/profile` âš ï¸ ç¼ºå¤± |

### 5.3 PetEdit.jsx - ç¼–è¾‘å® ç‰©ä¿¡æ¯

**é¡µé¢åŠŸèƒ½ï¼š**
- ä¿®æ”¹å® ç‰©å¤´åƒ
- ä¿®æ”¹åŸºç¡€ä¿¡æ¯ï¼ˆåå­—ã€ä½“é‡ã€å¹´é¾„ç­‰ï¼‰
- åˆ é™¤å® ç‰©

**éœ€è¦çš„ APIï¼š**
| æ“ä½œ | API |
|------|-----|
| è·å–å® ç‰©è¯¦æƒ… | `GET /pets/{pet_id}` âš ï¸ ç¼ºå¤± |
| æ›´æ–°å® ç‰©ä¿¡æ¯ | `PUT /pets/{pet_id}` âš ï¸ ç¼ºå¤± |
| ä¸Šä¼ å® ç‰©å¤´åƒ | `POST /pets/{pet_id}/avatar` âš ï¸ ç¼ºå¤± |
| åˆ é™¤å® ç‰© | `DELETE /pets/{pet_id}` âš ï¸ ç¼ºå¤± |

---

## æµç¨‹å…­ï¼šToken åˆ·æ–°ä¸ä¼šè¯ç®¡ç†

### è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    
    User->>Frontend: è¿›è¡Œä»»æ„æ“ä½œ
    Frontend->>Backend: API è¯·æ±‚ (æºå¸¦ access_token)
    Backend-->>Frontend: 401 Token è¿‡æœŸ
    Frontend->>Backend: POST /auth/refresh (æºå¸¦ refresh_token)
    Backend-->>Frontend: æ–°çš„ access_token + refresh_token
    Frontend->>Frontend: æ›´æ–°æœ¬åœ°å­˜å‚¨
    Frontend->>Backend: é‡è¯•åŸè¯·æ±‚ (æ–° token)
    Backend-->>Frontend: æ­£å¸¸å“åº”
    Frontend->>User: æ˜¾ç¤ºç»“æœï¼ˆç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰
```

### Token å­˜å‚¨ä½ç½®

```javascript
// localStorage
{
  "access_token": "eyJhbGc...",  // æœ‰æ•ˆæœŸ 30 åˆ†é’Ÿ
  "refresh_token": "eyJhbGc...", // æœ‰æ•ˆæœŸ 7 å¤©
}
```

---

## API è°ƒç”¨æ—¶æœºæ±‡æ€»

| é¡µé¢ | è¿›å…¥æ—¶è°ƒç”¨ | ç”¨æˆ·æ“ä½œæ—¶è°ƒç”¨ |
|------|------------|----------------|
| Login | - | `POST /auth/login` |
| Register | - | `POST /auth/send-code`, `POST /auth/verify-register` |
| HomePage | `GET /auth/me`, `GET /pets/`, `GET /meals/today` | `POST /meals/{id}/complete` |
| CreatePlan | `GET /pets/` | `POST /plans/stream` |
| Loading | - | SSE äº‹ä»¶ç›‘å¬ |
| PlanSummary | `GET /plans/{id}` | - |
| CalendarPage | `GET /calendar/monthly` | `GET /meals/date` |
| AnalysisPage | `GET /analysis/nutrition` | - |
| Profile | `GET /auth/me`, `GET /pets/` | `DELETE /pets/{id}` |
| ProfileEdit | - | `PUT /auth/profile`, `POST /auth/avatar` |
| PetEdit | `GET /pets/{id}` | `PUT /pets/{id}`, `DELETE /pets/{id}` |
| Onboarding | - | `POST /pets/` |

---

## é™„å½•ï¼šé¡µé¢è·¯ç”±

| è·¯ç”± | é¡µé¢ | éœ€è¦è®¤è¯ |
|------|------|----------|
| `/login` | ç™»å½• | âŒ |
| `/register` | æ³¨å†Œ | âŒ |
| `/` | é¦–é¡µ | âœ… |
| `/calendar` | æ—¥å† | âœ… |
| `/analysis` | åˆ†æ | âœ… |
| `/profile` | ä¸ªäººä¸­å¿ƒ | âœ… |
| `/profile/edit` | ç¼–è¾‘ç”¨æˆ· | âœ… |
| `/pet/edit/:id` | ç¼–è¾‘å® ç‰© | âœ… |
| `/plan/create` | åˆ›å»ºè®¡åˆ’ | âœ… |
| `/planning` | ç”Ÿæˆè¿›åº¦ | âœ… |
| `/plan/summary` | è®¡åˆ’æ¦‚è§ˆ | âœ… |
| `/plan/details` | è®¡åˆ’è¯¦æƒ… | âœ… |
| `/onboarding/step1` | æ·»åŠ å® ç‰© 1 | âœ… |
| `/onboarding/step2` | æ·»åŠ å® ç‰© 2 | âœ… |
| `/onboarding/step3` | æ·»åŠ å® ç‰© 3 | âœ… |
